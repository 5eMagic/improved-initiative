<!DOCTYPE html>
<html>
  <head>
  <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="tracker.css">
  
  <title>Combat Tracker - Improved Initiative</title>
  
  <script type="text/javascript" src="lib/knockout-3.3.0.debug.js"></script>
  <script type="text/javascript" src="lib/jquery-2.1.4.js"></script>
  <script type="text/javascript" src="lib/mousetrap.js"></script>
  <script type="text/javascript" src="js/ImprovedInitiative.js"></script>
  
  </head>
  <body id="tracker">
  <div class="keybindings">
    <!--ko foreach: Commands -->
    <div><div class='label' data-bind="text: Description"></div><input type="text" data-bind="value: KeyBinding" />
    </div>
    <!--/ko -->
    <input type="button" value="Save Keybindings" data-bind="click: ToggleKeybindingDisplay" />
  </div>
  <!-- ko template: { if: Library.PreviewCreature } -->
  <div class="preview statblock" data-bind="
      event: {
        mouseout: Library.HidePreviewPane
      },
      afterRender: Library.AdjustPreviewPane,
      component: { 
        name: 'defaultstatblock',
        params:{ 
          creature: Library.PreviewCreature
        }
      }"></div>
  <!-- /ko -->
  <div class="libraries">
    <h1>Library</h1>
    <div class="tabs">
      <div data-bind="click: Library.DisplayTab.bind(null, 'Creatures')">Creatures</div>
      <div data-bind="click: Library.DisplayTab.bind(null, 'Players')">Players</div>
      <div data-bind="click: Library.DisplayTab.bind(null, 'Encounters')">Encounters</div>
    </div>
    <div class="library" data-bind="with: Library">
      <!-- ko if: DisplayTab() == 'Encounters' -->
      <ul class="creature-library" data-bind="foreach: SavedEncounterIndex">
        <li data-bind="click: $root.LoadEncounterByName.bind(null, $data)">
          <span data-bind="text: $data"></span>
        </li>
      </ul>
      <!-- /ko -->
      <!-- ko ifnot: DisplayTab() == 'Encounters' -->
      <input class="filter-library" placeholder="Filter..." data-bind="textInput: LibraryFilter" />
      <ul class="creature-library" data-bind="foreach: FilteredCreatures">
        <li>
          <span class="fa" data-bind="click: $root.Encounter().AddCreature, text: Name"></span>
          <span class="fa fa-edit" data-bind="click: $parent.EditStatBlock"></span>
          <span class="fa fa-search preview" data-bind="event: {
            mouseover: $parent.PreviewCreature,
            mouseout: $parent.HidePreviewPane
          }"></span>
        </li>
      </ul>
      <div class="interface-buttons">
        <div data-bind="click: AddNewCreature"><span class="fa fa-plus"></span></div>
        <div onclick="$('.libraries').slideUp()"><span class="fa fa-chevron-up"></span></div>
      </div>
      <!-- /ko -->
    </div>
  </div>
  <div class="views">

  <div class="active statblock" data-bind="if: Encounter().ActiveCreature()">
    <h1>Active Creature</h1>
    <div data-bind="visible: Encounter().ActiveCreature(), 
    component: { 
      name: 'activestatblock', 
      params: { 
        creature: Encounter().ActiveCreatureStatblock() 
      } 
    }"></div>
  </div>
  
<!-- ko if: StatBlockEditor.StatBlock() -->
  <div class="editor" data-bind="component: {
    name: 'editstatblock',
    params: {
      editor: StatBlockEditor
    }
  }"></div>
<!-- /ko -->

<!-- ko ifnot: StatBlockEditor.StatBlock() -->

  <div class="tracker">
    <div class="encounter" data-bind="with: Encounter">
      <h1>Tracker</h1>
      <ul class="combatants">
        <li class="creature header">
          <div class="initiative"><span class="fa fa-forward"></span></div>
          <div class="name">Combatant</div>
          <div class="hp"><span class = "fa fa-heart"></span></div>
          <div class="ac"><span class = "fa fa-shield"></span></div>
          <div class="tags">Tags</div>
        </li>
        <!-- ko foreach: Creatures -->
        <li class="creature" data-bind="
          css: { selected: $parent.SelectedCreature() == $data, 
                 active: $parent.ActiveCreature() == $data }, 
          click: $parent.SelectedCreature,
          component: {
            name: 'combatant',
            params: { creature: $data, addUserPoll: $root.UserPollQueue.Add }
          }">
        </li>
        <!-- /ko -->
      </ul>
    </div>
    <!-- ko if: UserPollQueue.CurrentPoll() -->
      <form class="user-response-requests" data-bind="
        submit:UserPollQueue.Resolve,
        html:UserPollQueue.CurrentPoll().requestContent,
        focusOnRender:UserPollQueue.CurrentPoll().inputSelector">
      </form>
    <!-- /ko -->
  </div>

<!-- /ko -->

    <div class="selected statblock">
      <h1>Target Creature</h1>
      <div data-bind="visible: Encounter().SelectedCreature(), 
      component: { 
        name: 'defaultstatblock', 
        params:{ 
          creature: Encounter().SelectedCreatureStatblock(),
        } 
      }"></div>
    </div>
  </div>
  <div class="interface-buttons" data-bind="with:Encounter">
    <div class='highlight' data-bind="click: RollInitiative">Roll Initiative! <span class="fa fa-play"></span></div>
    <div data-bind="click: NextTurn">Next Turn <span class="fa fa-step-forward"></span></div>
    <div data-bind="click: MoveSelectedCreatureDown">Move <span class="fa fa-arrow-down"></span></div>
    <div data-bind="click: MoveSelectedCreatureUp">Move <span class="fa fa-arrow-up"></span></div>
    <div onclick="$('.libraries').slideDown()">Add <span class="fa fa-plus"></span></div>
    <div data-bind="click: $root.LaunchPlayerWindow">Player Window <span class="fa fa-users"></span></div>
    <div data-bind="click: $root.ToggleKeybindingDisplay">Keybindings <span class="fa fa-keyboard-o"></span></div>
  </div>
  </body>
</html>